machine:
  timezone: America/New_York
  node:
    version: 0.10.28
  services:
    - docker

dependencies:
  override:
    - docker build -t $CIRCLE_PROJECT_REPONAME .

test:
  override:
    - >
      docker run -v $PWD:/var/www
      $CIRCLE_PROJECT_REPONAME bash -c 'npm install && npm run-script test-cov'
  post:
    - >
      docker run -v $PWD:/var/www
      -e COVERALLS_SERVICE_NAME=circleci
      -e COVERALLS_REPO_TOKEN=$COVERALLS_REPO_TOKEN
      -e COVERALLS_SERVICE_JOB_ID=$CIRCLE_BUILD_NUM
      -e COVERALLS_GIT_COMMIT=$CIRCLE_SHA1
      -e COVERALLS_GIT_BRANCH=$CIRCLE_BRANCH
      $CIRCLE_PROJECT_REPONAME npm run-script coveralls
